# Vulnerability Analysis: Production vs Development Dependencies

## Analysis Summary

**Date**: 2025-06-08  
**Total Vulnerabilities**: 89 across 34 packages  
**Direct Dependencies**: 36 packages in requirements.txt  
**Action Required**: Critical upgrades needed for production

---

## ğŸ¯ Critical Packages (Direct Dependencies in requirements.txt)

### âœ… **Packages We Control Directly**

| Package | In requirements.txt | Current Version | Required Version | Priority |
|---------|---------------------|-----------------|------------------|----------|
| **authlib** | âœ… YES | 1.2.1 | â‰¥1.6.5 | ğŸ”´ CRITICAL |
| **black** | âœ… YES | 23.11.0 | â‰¥24.3.0 | ğŸŸ¡ MEDIUM |

### âš ï¸ **Transitive Dependencies (Pulled by other packages)**

These are NOT in requirements.txt but are installed as dependencies:

| Package | Required By | Current | Required | Priority |
|---------|-------------|---------|----------|----------|
| **starlette** | fastapi | 0.46.2 | â‰¥0.47.2 | ğŸŸ¡ MEDIUM |
| **h11** | uvicorn, httpx | 0.14.0 | â‰¥0.16.0 | ğŸ”´ HIGH |
| **h2** | httpx | 4.2.0 | â‰¥4.3.0 | ğŸ”´ HIGH |
| **certifi** | httpx, requests | 2022.12.7 | â‰¥2024.7.4 | ğŸŸ¡ MEDIUM |
| **idna** | httpx, requests | 3.4 | â‰¥3.7 | ğŸŸ¡ MEDIUM |
| **urllib3** | requests (indirect) | 2.2.3 | â‰¥2.5.0 | ğŸ”´ HIGH |
| **requests** | supabase (likely) | 2.32.3 | â‰¥2.32.4 | ğŸ”´ HIGH |
| **aiohttp** | unknown/optional | 3.11.18 | â‰¥3.12.14 | ğŸ”´ HIGH |
| **tornado** | unknown | 6.4.1 | â‰¥6.5 | ğŸŸ¡ MEDIUM |

---

## ğŸš« Non-Production Packages (Not Used)

These vulnerable packages are **NOT** in our requirements and are likely:
- Anaconda/Conda artifacts
- Development environment cruft
- ML research tools not used in production

### Flask Ecosystem (NOT USED)
- âŒ flask - We use **FastAPI**, not Flask
- âŒ flask-cors - Not needed (FastAPI has built-in CORS)
- âŒ werkzeug - Flask dependency
- âŒ jinja2 - FastAPI uses different templating (if any)

### ML/Research Tools (NOT USED in Production)
- âŒ torch - Not in requirements
- âŒ transformers - Not in requirements
- âŒ scikit-learn - Not in requirements
- âŒ astropy - Not in requirements
- âŒ imagecodecs - Not in requirements
- âŒ mpmath - Not in requirements
- âŒ numexpr - Not in requirements
- âŒ joblib - Not in requirements

### Web Scraping (NOT USED)
- âŒ scrapy - Not in requirements (using httpx/feedparser instead)
- âŒ twisted - Not in requirements

### Jupyter Tools (Dev Only)
- âŒ jupyter-server - Development only
- âŒ jupyterlab - Development only
- âŒ jupyter-core - Development only

### Build/Dev Tools (System Level)
- âš ï¸ setuptools - System-level, should be upgraded
- âš ï¸ pip - System-level, should be upgraded

### Miscellaneous (NOT USED)
- âŒ cookiecutter - Not in requirements
- âŒ py - Not in requirements
- âŒ ecdsa - Likely pulled by python-jose, but jose uses cryptography instead
- âŒ protobuf - Not in requirements

---

## ğŸ“‹ Action Plan by Priority

### ğŸ”´ **Phase 1: CRITICAL - Must Fix Before Production**

#### 1. Direct Dependencies (in requirements.txt)
```bash
# Upgrade authlib (JWT/OAuth security)
authlib==1.2.1  â†’  authlib>=1.6.5
```

#### 2. Upgrade Parent Packages (forces transitive updates)
```bash
# These upgrades will pull in fixed versions of h11, h2, certifi, idna, urllib3
fastapi==0.104.1  â†’  fastapi>=0.115.0  # Gets latest starlette
uvicorn[standard]==0.24.0  â†’  uvicorn[standard]>=0.32.0  # Gets h11>=0.16.0
httpx==0.25.1  â†’  httpx>=0.28.0  # Gets h11>=0.16.0, h2>=4.3.0
```

#### 3. Explicit Constraints (ensure minimum versions)
Add to requirements.txt:
```bash
# Security constraints (transitive deps)
h11>=0.16.0
h2>=4.3.0
certifi>=2024.7.4
idna>=3.7
urllib3>=2.5.0
starlette>=0.47.2
```

### ğŸŸ¡ **Phase 2: MEDIUM - Within 1 Week**

```bash
# Development tools
black==23.11.0  â†’  black>=24.3.0
```

### ğŸŸ¢ **Phase 3: OPTIONAL - System Level**

```bash
# Run once in environment (not in requirements.txt)
python -m pip install --upgrade 'pip>=25.3' 'setuptools>=78.1.1'
```

---

## ğŸ“Š Impact Summary

### Before Upgrades
- **89 vulnerabilities** across 34 packages
- **25 critical/high** severity issues
- **Production risk**: HIGH

### After Upgrades (Projected)
- **~30 vulnerabilities** (from unused packages)
- **0-5 critical** issues (transitive deps we can't control)
- **Production risk**: LOW

### Vulnerabilities Eliminated
- âœ… ~60 vulnerabilities from unused packages (ignored)
- âœ… ~25 critical vulnerabilities (fixed via upgrades)
- âœ… ~15 medium vulnerabilities (fixed via upgrades)

---

## ğŸ” Dependency Tree Analysis

### FastAPI Stack
```
fastapi (0.104.1)
â”œâ”€â”€ starlette (0.46.2) â† VULNERABLE
â”œâ”€â”€ pydantic (2.5.0) â† OK
â””â”€â”€ typing-extensions â† OK
```

### Uvicorn Stack
```
uvicorn[standard] (0.24.0)
â”œâ”€â”€ h11 (0.14.0) â† VULNERABLE
â”œâ”€â”€ httptools â† OK
â”œâ”€â”€ uvloop â† OK
â””â”€â”€ websockets â† OK
```

### HTTPX Stack (HTTP Client)
```
httpx (0.25.1)
â”œâ”€â”€ h11 (0.14.0) â† VULNERABLE
â”œâ”€â”€ h2 (4.2.0) â† VULNERABLE
â”œâ”€â”€ certifi (2022.12.7) â† VULNERABLE
â”œâ”€â”€ idna (3.4) â† VULNERABLE
â””â”€â”€ httpcore
    â””â”€â”€ urllib3 (2.2.3) â† VULNERABLE (indirect)
```

### Supabase Stack
```
supabase (2.0.3)
â”œâ”€â”€ requests (2.32.3) â† VULNERABLE
â”‚   â”œâ”€â”€ urllib3 (2.2.3) â† VULNERABLE
â”‚   â”œâ”€â”€ certifi (2022.12.7) â† VULNERABLE
â”‚   â””â”€â”€ idna (3.4) â† VULNERABLE
â””â”€â”€ other deps
```

---

## ğŸ¯ Why This Approach Works

1. **Upgrading parent packages** (fastapi, uvicorn, httpx) automatically pulls in fixed versions of their dependencies
2. **Adding explicit constraints** ensures we don't accidentally downgrade
3. **Ignoring unused packages** reduces noise and focuses on real production risk
4. **System-level upgrades** (pip, setuptools) done once, not in requirements.txt

---

## ğŸ“ Notes

- **Flask vulnerabilities are irrelevant** - we use FastAPI
- **ML package vulnerabilities are irrelevant** - we don't use ML in production
- **Most vulnerabilities are in transitive deps** - fixed by upgrading parents
- **Some packages are Conda artifacts** - should clean up environment eventually

---

## âœ… Verification Plan

After upgrades:
1. Run `pip install -r requirements.txt` in clean venv
2. Run `pip-audit` to verify reduction
3. Test application startup and health checks
4. Run test suite to ensure compatibility
5. Deploy to staging and verify

---

**End of Analysis**
